---
title: ã€Vueã€‘æºç è§£æ
date: 2019-03-18 09:50:34
categories: Vue
tags: Vue
---

ç°åœ¨ä¸‰å¤§æ¡†æ¶é£èµ·äº‘æ¶Œï¼Œ `JQuery`è€å¤§å“¥çš„å…‰è¾‰ä¸å†ï¼Œ ä½¿å‰ç«¯æˆä¸ºäº†å„è·¯è¯¸ä¾¯çš„å…µå®¶å¿…äº‰ä¹‹åœ°ï¼Œ 

å½“ç„¶ä½œä¸ºä¸€åä¼˜è´¨çš„å‰ç«¯ï¼Œå…‰è·Ÿé£å­¦æ¡†æ¶æ˜¯è‚¯å®šä¸è¡Œçš„ï¼Œ è¦çŸ¥å…¶ç„¶è€ŒçŸ¥å…¶æ‰€ä»¥ç„¶

è¦äº†è§£`MVVM`çš„æœ¬è´¨åŸç†ï¼Œ `virtual Dom`å’Œ `Diff`ç®—æ³•è§£å†³çš„é—®é¢˜

æ‹’ç»ç›²ç›®è·Ÿé£


## ğŸdiffDomä¼˜åŠ£
ç°åœ¨å¾ˆå¤šäººéƒ½è¯´ `Vue`, `React` å¤šç‰›ï¼Œ `Diff`ç®—æ³•å¿«ï¼Œä¸ç”¨æ“ä½œ`Dom`ã€‚

åªèƒ½æ— è¯­ã€‚

`Diff`ç®—æ³•ä¸æ˜¯ä¸éœ€è¦æ“ä½œ`Dom`,  è€Œæ˜¯ä¸éœ€è¦å¼€å‘è€…å»æ“ä½œ`Dom`äº†ï¼Œ `Diff`ç®—æ³•å…¶å®ä¸å¿«ï¼Œ å°±ç®—ä½¿ç”¨äº†`virtual Dom`,  è¿˜å¾—èŠ±å®ç°æŠŠçœŸå®`Dom` è½¬æ¢ä¸º `virtual Dom` å†å»æ¯”å¯¹ï¼Œ è¿™è¿œè¿œæ²¡æœ‰`js`ç›´æ¥ `getElementById`ç›´è¾¾ç›®æ ‡æ¥çš„å¿«

é‚£Diffç®—æ³•ä¸å¿«ä¸ºä»€ä¹ˆè¿˜è¦ç”¨å‘¢?

`Diff`ç®—æ³•å…¶å®æ˜¯ç»™é‚£äº›æ¯”è¾ƒéšæ„çš„æ–°æ‰‹å¼€å‘è€…å‡†å¤‡çš„

çœ‹è¿™ä¸ªä¾‹å­

```HTML
<!-- åŸæœ¬çš„dom -->
<ul id="ul">
  <li>a</li>
  <li>a</li>
  <li>a</li>
</ul>
```
```JavaScript
// æ‹¿åˆ°ç»“æœä¸ç®¡ä¸‰ä¸ƒäºŒåä¸€æŠŠæ—§domå…¨æ›¿æ¢äº†
$.get('/api', (res) => {
  var _HTML = ""
  for(var i=0; i< res.length; i++){
    _HTML = "<li>" + res[i] +"</li>"
  }
  $("#ul").html(_HTML)
})
```

å¦‚æœæ˜¯åŸå§‹çš„`Dom`æ“ä½œï¼Œ æœ‰å¾ˆå¤šå°ç™½ä¼šåƒè¿™ä¸ªä¾‹å­ä¸€æ ·ï¼Œ ä¸ç®¡`Dom`éœ€ä¸éœ€è¦æ›´æ–°ï¼Œ ä»–éƒ½æŠŠ`ajax`è¿”å›çš„è¯·æ±‚å…¨éƒ¨è·‘ä¸€è¾¹ï¼Œç”Ÿæˆ`HTML`æ¨¡æ¿ï¼Œ ç„¶åæŠŠåŸæœ¬çš„æ‰€æœ‰`li`éƒ½åˆ äº†ï¼Œ  å†æŠŠæ–°çš„æ¨¡æ¿æ”¾è¿›å»ï¼Œ `Dom`å°‘è¿˜çœ‹ä¸å‡ºæ¥ï¼Œ å¦‚æœ`Dom`å¤šäº†å‘¢ï¼Œ ä¸Šåƒçš„`Dom`ï¼Œ è¿™é¡¿æ“ä½œä¸€ä¸‹å°±ç©ç‚¸äº†ã€‚

å†µä¸”ç½‘ç«™ä¼˜åŒ–åŸåˆ™å°±æ˜¯å°½é‡å‡å°`Dom`æ“ä½œï¼Œ å¦‚æœæ˜¯æœ‰ç»éªŒçš„å¼€å‘è€…ï¼Œ ä¼šé€‰æ‹©æ‰¾åˆ°æœ‰å˜åŒ–çš„ä½ç½®ï¼Œä½¿ç”¨`append`æ’å…¥



## ğŸ“„Vueæ¶æ„ç›®å½•
å»[Vueå®˜ç½‘](https://github.com/vuejs/vue)ä¸‹è½½`Vue`æºç çœ‹çœ‹ï¼Œ

æ‰“å¼€é‡Œé¢ä¼šæœ‰ä¸€ä¸ª `src`ç›®å½•ï¼Œ é‡Œé¢å°±æ˜¯æ•´ä¸ªçš„`Vue`æºç 

ç›®å‰æœ‰6ä¸ªç›®å½•ï¼Œ ä½œç”¨åˆ†åˆ«å¦‚ä¸‹

![Vueç›®å½•](http://img.nixiaolei.com/2019-03-30-10-44-35.png)


`Vue.js` çš„ç»„æˆæ˜¯ç”± `core` + å¯¹åº”çš„ 'å¹³å°' è¡¥å……ä»£ç æ„æˆï¼ˆç‹¬ç«‹æ„å»ºå’Œè¿è¡Œæ—¶æ„å»ºåªæ˜¯ `platforms` ä¸‹ `web` å¹³å°çš„ä¸¤ç§é€‰æ‹©ï¼‰

`Vue`çš„æ ¸å¿ƒåŸç†å°±åœ¨`core`æ–‡ä»¶å¤¹ä¸­ï¼Œ è®©æˆ‘ä»¬è¿›å…¥ `core` æ–‡ä»¶å¤¹çœ‹çœ‹

![coreæ–‡ä»¶å¤¹](http://img.nixiaolei.com/2019-03-30-10-57-26.png)

äº†è§£äº†ç›®å½•ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥ç ”ç©¶`Vue`çš„åŒå‘ç»‘å®š

## ğŸ”—åŒå‘ç»‘å®šï¼ˆå“åº”å¼åŸç†ï¼‰ æ‰€æ¶‰åŠåˆ°çš„æŠ€æœ¯
* âœ… **Obejct.defineProperty** _ã€æä¾›getter å’Œ setterã€‘_
* âœ… **Observer** _ã€æä¾›getter å’Œ setterã€‘_
* âœ… **watcher**  _ã€æä¾›getter å’Œ setterã€‘_
* âœ… **Dep** _ã€è´Ÿè´£æ”¶é›†watcherã€‘_
* âœ… **Directive** _ã€å¤„ç†Vueæ¨¡æ¿æŒ‡ä»¤ã€‘_


### Obejct.defineProperty


`Obejct.defineProperty` æ˜¯æ•´ä¸ª`Vue`çš„çµé­‚ï¼Œ 

æ¥çœ‹ä¸€ä¸‹`Obejct.defineProperty` å¦‚ä½•ä½¿ç”¨
```JavaScript
var obj = {}
var c;
Object.defineProperty(obj, 'a', {
  get() {
    console.log('getter')
    return a
  },
  set(newVal) {
    console.log('setter')
    c = newVal
    this.a = newVal
  }
})

obj.a = '234'
console.log(c) // 234
console.log(obj.a) // 234
```


å®ƒå¸®åŠ©`Vue`å®ç°äº†åŒå‘ç»‘å®š, ä½†ä¹Ÿå› ä¸ºè¿™ä¸ªï¼Œ `Vue`ä¹Ÿåªèƒ½èˆå¼ƒäº†å¯¹ä½ç‰ˆæœ¬æµè§ˆå™¨çš„æ”¯æŒã€‚


![definePropertyå…¼å®¹](http://img.nixiaolei.com/2019-03-30-11-48-41.png)

å®ƒåªèƒ½å…¼å®¹åˆ°`IE9` ï¼Œ å¹¶ä¸”å¸‚é¢ä¸Šçš„`polyfill`å®ç°çš„ä¹Ÿå¹¶ä¸æ˜¯å¾ˆå¥½

é‚£ä½ç‰ˆæœ¬å¦‚ä½•ä»£æ›¿`Obejct.defineProperty` ï¼Œ éš¾é“çœŸæ²¡äº†å®ƒå°±ä¸è¡Œå—ï¼Ÿ


**å½“ç„¶æœ‰**ï¼š

1. ğŸ‘† > IE 7

å®é™…ä¸Šåœ¨`IE7`çš„æ—¶å€™å°±å·²ç»æœ‰æš´éœ²äº† `__defineGetter__` æ–¹æ³•ï¼Œ
![__defineGetter__](http://img.nixiaolei.com/2019-03-30-12-57-56.png)

å…·ä½“ç”¨æ³•å¦‚ä¸‹
```JavaScript
var random = {};
random.__defineGetter__('ten', function() { 
    return Math.floor(Math.random()*10); });
random.__defineGetter__('hundred', function() { 
    return Math.floor(Math.random()*100); });

random.ten // éšæœºçš„ä¸€ä¸ªå€¼
```

2.  ğŸ‘‡ < IE 7

æ—©å¹´é—´çš„`IE` æ˜¯æ”¯æŒ`VBScript`,  [VBScript](http://www.w3school.com.cn/vbscript/index.asp) å°±å¯ä»¥ç›´æ¥å†™ç±»ï¼Œ å¹¶ä¸”ä¹Ÿæ”¯æŒ`get`ï¼Œ`set`æ–¹æ³•

```JavaScript
class Test {
  get name () {
    
  }
  set name() {

  }
}
```

### ğŸ¶éœ¸é“çš„IE
è¯´äº†è¿™ä¹ˆå¤š`IE`çš„åï¼Œ è¿™é‡Œä¹Ÿå¸¦ä¸€å˜´`IE`çš„å¥½ï¼Œ

`IE`èƒ½å¤Ÿè°ƒç”¨`EXE`ç¨‹åº, æ¯”å¦‚`JS`æ— æ³•è®¾ç½®æ‰“å°æœºçš„å®½é«˜ï¼Œå°±å¯ä»¥åˆ©ç”¨`ActiveObjectX`æ¥åšåˆ°, ç”šè‡³å¯ä»¥ä¿®æ”¹`word`æ ¼å¼ç­‰ç­‰  , æ‰€ä»¥åŠå…¬ç±»çš„é¡¹ç›®ç¦»ä¸å¼€`IE`





## ğŸ˜•MVVM åŒå‘æ•°æ®ç»‘å®šæµç¨‹


MVVM: Modelâ€“viewâ€“viewmodel

é‚£æ€ä¹ˆåŒºåˆ†è¿™äº›å±‚å‘¢

* ğŸš€**Model**: `Observer`
* âœˆï¸**view** : `directive`
* ğŸšš**viewmodel**: `Watcher` && `Dep`  _ã€ç”¨äºè¿æ¥ Model å’Œ viewã€‘_


![åŒå‘æ•°æ®ç»‘å®š](http://img.nixiaolei.com/2019-03-30-11-51-42.png)



å…ˆçœ‹`Directive`, è¿™å°±æ˜¯æˆ‘ä»¬å¹³æ—¶å†™çš„`vue`æŒ‡ä»¤ï¼Œ å¦‚ä¸Šé¢ä¸¾ä¾‹å¾—çš„`v-text="times"`, è¿™å°±æ˜¯ä¸€ä¸ªæŒ‡ä»¤ï¼Œ ä¸€ä¸ª`Directive`ä¼šåˆ†é…ä¸€ä¸ª`Watcher`



### Observer

è§‚å¯Ÿè€…æ¨¡å¼æ˜¯è½¯ä»¶è®¾è®¡æ¨¡å¼çš„ä¸€ç§ã€‚åœ¨æ­¤ç§æ¨¡å¼ä¸­ï¼Œä¸€ä¸ªç›®æ ‡å¯¹è±¡ç®¡ç†æ‰€æœ‰ç›¸ä¾äºå®ƒçš„è§‚å¯Ÿè€…å¯¹è±¡ï¼Œå¹¶ä¸”åœ¨å®ƒæœ¬èº«çš„çŠ¶æ€æ”¹å˜æ—¶ä¸»åŠ¨å‘å‡ºé€šçŸ¥ã€‚è¿™é€šå¸¸é€è¿‡å‘¼å«å„è§‚å¯Ÿè€…æ‰€æä¾›çš„æ–¹æ³•æ¥å®ç°ã€‚æ­¤ç§æ¨¡å¼é€šå¸¸è¢«ç”¨æ¥å®æ—¶äº‹ä»¶å¤„ç†ç³»ç»Ÿã€‚è®¢é˜…è€…æ¨¡å¼æ¶‰åŠä¸‰ä¸ªå¯¹è±¡ï¼šå‘å¸ƒè€…ã€ä¸»é¢˜å¯¹è±¡ã€è®¢é˜…è€…ï¼Œä¸‰ä¸ªå¯¹è±¡é—´çš„æ˜¯ä¸€å¯¹å¤šçš„å…³ç³»ï¼Œæ¯å½“ä¸»é¢˜å¯¹è±¡çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œå…¶ç›¸å…³ä¾èµ–å¯¹è±¡éƒ½ä¼šå¾—åˆ°é€šçŸ¥ï¼Œå¹¶è¢«è‡ªåŠ¨æ›´æ–°ã€‚

ç®€å•çš„æè¿°å°±æ˜¯:

ä½ æƒ³ä¹°æ¼«ç”»ï¼Œ ä½†æ˜¯é—®äº†æŠ¥åˆŠäº­çš„å¤§çˆ·ï¼Œ å¤§çˆ·è¯´ç°åœ¨æ²¡æœ‰ï¼Œ è¿˜æ²¡åˆ°è´§ï¼Œ ç„¶åä½ å›å»äº†ï¼Œ ç¬¬äºŒå¤©ä½ åˆå»é—®ï¼Œ å¤§çˆ·è¿˜æ˜¯è¯´æ²¡æœ‰ï¼Œ å¦‚æœä½ æ¯å¤©è¿™æ ·é—®ï¼Œ å¤§çˆ·ä¼°è®¡ä¼šå«Œä½ çƒ¦ã€‚ å¦‚æœè¿™æ—¶å€™ä½ æŠŠä½ çš„ç”µè¯ç»™å¤§çˆ·ï¼Œ å¤§çˆ·è®°å½•åˆ°ä»–çš„**æœ¬å­**ä¸Š,  å½“å¤§çˆ·çš„æ¼«ç”»åˆ°è´§çš„æ—¶å€™ç”µè¯é€šçŸ¥ä½ ã€‚

è¿™æ—¶ä½ å°±æ˜¯`è®¢é˜…è€…`, å¤§çˆ·å°±æ˜¯`å‘å¸ƒè€…`, ä½ ä»¬å°±å­˜åœ¨ä¸€ä¸ªå‘å¸ƒè®¢é˜…è€…çš„å…³ç³»



**Vue ä¸­çš„Observer**

Observerä¼šè§‚å¯Ÿä¸¤ç§ç±»å‹çš„æ•°æ®ï¼Œ`Object` ä¸ `Array`
å¯¹äº`Array`ç±»å‹çš„æ•°æ®ï¼Œç”±äº `JavaScript` çš„é™åˆ¶ï¼Œ `Vue` ä¸èƒ½æ£€æµ‹å˜åŒ–,ä¼šå…ˆé‡å†™æ“ä½œæ•°ç»„çš„åŸå‹æ–¹æ³•ï¼Œé‡å†™åèƒ½è¾¾åˆ°ä¸¤ä¸ªç›®çš„ï¼Œ

å½“æ•°ç»„å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè§¦å‘ `notify` å¦‚æœæ˜¯ `push`ï¼Œ`unshift`ï¼Œ`splice` è¿™äº›æ·»åŠ æ–°å…ƒç´ çš„æ“ä½œï¼Œåˆ™ä¼šä½¿ç”¨`observer`è§‚å¯Ÿæ–°æ·»åŠ çš„æ•°æ®é‡å†™å®ŒåŸå‹æ–¹æ³•åï¼Œéå†æ‹¿åˆ°æ•°ç»„ä¸­çš„æ¯ä¸ªæ•°æ® ä½¿ç”¨`observer`è§‚å¯Ÿå®ƒè€Œå¯¹äº`Object`ç±»å‹çš„æ•°æ®ï¼Œåˆ™éå†å®ƒçš„æ¯ä¸ª`key`ï¼Œä½¿ç”¨ `defineProperty` è®¾ç½® `getter` å’Œ `setter`ï¼Œå½“è§¦å‘`getter`çš„æ—¶å€™ï¼Œ`observer`åˆ™å¼€å§‹æ”¶é›†ä¾èµ–ï¼Œè€Œè§¦å‘`setter`çš„æ—¶å€™ï¼Œ`observer`åˆ™è§¦å‘`notify`ã€‚

#### å¯¹ Object çš„å¤„ç†
`Observer` å¯¹è±¡çš„æ ‡å¿—å°±æ˜¯`__ob__` è¿™ä¸ªå±æ€§ï¼Œè¿™ä¸ªå±æ€§ä¿å­˜äº† `Observer` å¯¹è±¡è‡ªå·±æœ¬èº«ã€‚å¯¹è±¡åœ¨è½¬åŒ–ä¸º `Observer` å¯¹è±¡çš„è¿‡ç¨‹ä¸­æ˜¯ä¸€ä¸ªé€’å½’çš„è¿‡ç¨‹ï¼Œå¯¹è±¡çš„å­å…ƒç´ å¦‚æœæ˜¯å¯¹è±¡æˆ–æ•°ç»„çš„è¯ï¼Œä¹Ÿä¼šè½¬åŒ–ä¸º `Observer` å¯¹è±¡


#### å¯¹æ•°ç»„çš„å¤„ç†

å…¶å® `observeArray` æ–¹æ³•å°±æ˜¯å¯¹æ•°ç»„è¿›è¡Œéå†ï¼Œé€’å½’è°ƒç”¨ `observe` æ–¹æ³•ï¼Œæœ€ç»ˆéƒ½ä¼šèµ°å…¥ `walk` æ–¹ç›‘æ§å•ä¸ªå…ƒç´ ã€‚è€Œ `walk` æ–¹æ³•å°±æ˜¯éå†å¯¹è±¡ï¼Œç»“åˆ defineReactive æ–¹æ³•é€’å½’å°†å±æ€§è½¬åŒ–ä¸º `getter` å’Œ `setter`






### Watcher
`Watcher` æ˜¯å°†æ¨¡æ¿å’Œ `Observer` å¯¹è±¡ç»“åˆåœ¨ä¸€èµ·çš„çº½å¸¦ã€‚`Watcher` æ˜¯è®¢é˜…è€…æ¨¡å¼ä¸­çš„è®¢é˜…è€…ã€‚`Watcher` çš„ä¸¤ä¸ªå‚æ•°ï¼š `expOrFn` æœ€ç»ˆä¼šè¢«è½¬æ¢ä¸º `getter` å‡½æ•°ï¼Œ cb æ˜¯æ›´æ–°æ—¶æ‰§è¡Œçš„å›è°ƒã€‚ä¾èµ–æ”¶é›†çš„å…¥å£å°±æ˜¯getå‡½æ•°ã€‚

> getter å‡½æ•°æ˜¯ç”¨æ¥è¿æ¥ç›‘æ§å±æ€§ä¸ `Watcher` çš„å…³é”®


åªæœ‰é€šè¿‡`watcher` è§¦å‘çš„getter ä¼šæ”¶é›†ä¾èµ–ï¼Œè€Œæ‰€è°“çš„è¢«æ”¶é›†çš„ä¾èµ–å°±æ˜¯å½“å‰`watcher`.åˆå§‹åŒ–æ—¶ä¼ å…¥çš„å‚æ•° expOrFn ä¸­æ¶‰åŠåˆ°çš„æ¯ä¸€é¡¹æ•°æ®ï¼Œç„¶åè§¦å‘è¯¥æ•°æ®é¡¹çš„ getter å‡½æ•°ï¼›getter å‡½æ•°ä¸­å°±æ˜¯é€šè¿‡åˆ¤æ–­ Dep.targetçš„æœ‰æ— æ¥åˆ¤æ–­æ˜¯ `Watcher` åˆå§‹åŒ–æ—¶è°ƒç”¨çš„è¿˜æ˜¯æ™®é€šæ•°æ®è¯»å–ï¼Œå¦‚æœæœ‰åˆ™è¿›è¡Œä¾èµ–æ”¶é›†




### Dep

è¿™ä¸ªæ–¹æ³•æ˜¯åœ¨å“åº”å¼çš„è¿‡ç¨‹ä¸­è°ƒç”¨çš„ï¼Œç”¨æˆ·ä¿®æ”¹æ•°æ®è§¦å‘ setter å‡½æ•°ï¼Œå‡½æ•°çš„æœ€åä¸€è¡Œå°±æ˜¯è°ƒç”¨ dep.notify å»é€šçŸ¥è®¢é˜…è€…æ›´æ–°è§†å›¾ã€‚

### Directive

![Directive](http://img.nixiaolei.com/2019-03-30-14-50-38.png)


å…³äºç¼–è¯‘è¿™å—vueåˆ†äº†ä¸¤ç§ç±»å‹ï¼Œä¸€ç§æ˜¯æ–‡æœ¬èŠ‚ç‚¹ï¼Œä¸€ç§æ˜¯å…ƒç´ èŠ‚ç‚¹



vueå†…ç½®äº†è¿™ä¹ˆå¤šçš„æŒ‡ä»¤ï¼Œè¿™äº›æŒ‡ä»¤éƒ½ä¼šæŠ›å‡ºä¸¤ä¸ªæ¥å£bind å’Œ updateï¼Œè¿™ä¸¤ä¸ªæ¥å£çš„ä½œç”¨æ˜¯ï¼Œç¼–è¯‘çš„æœ€åä¸€æ­¥æ˜¯æ‰§è¡Œæ‰€æœ‰ç”¨åˆ°çš„æŒ‡ä»¤çš„bindæ–¹æ³•ï¼Œè€Œ update æ–¹æ³•åˆ™æ˜¯å½“watcher è§¦å‘ update æ—¶ï¼ŒDirectiveä¼šè§¦å‘æŒ‡ä»¤çš„updateæ–¹æ³•


observe -> è§¦å‘setter -> watcher -> è§¦å‘update -> Directive -> è§¦å‘update -> æŒ‡ä»¤





## ğŸ’¥æºç åˆ†æ
Vueçš„å®Œå…¨ç‰ˆæºç æœ‰å¾ˆå¤šåˆ¤æ–­ä»¥åŠå…¶ä»–çš„é€»è¾‘ï¼Œ å¯¹äºè§‚çœ‹æºç çš„äººï¼Œä¼šé€ æˆæå¤§çš„å›°éš¾ï¼Œ

å› æ­¤å‡†å¤‡äº†è¿™ç‰ˆä»¿ç…§Vueæµç¨‹å®ç°çš„ å®ç°äº†åŒå‘ç»‘å®šçš„[ç®€ç‰ˆVue](https://github.com/nxl3477/note/tree/master/Javascript/Vue/%E5%AE%9E%E7%8E%B0vue), æ–¹ä¾¿å­¦ä¹ ç†è§£

é€šè¿‡è¿™ç‰ˆå¯¹[Vueæºç çš„ç®€æ˜“ç¿»ç‰ˆ](https://github.com/nxl3477/note/tree/master/Javascript/Vue/%E5%AE%9E%E7%8E%B0vue)ï¼Œ æˆ‘ä»¬æ¥å¿«é€Ÿç†è§£VueåŸç†

### âœ¨ new Vue

é¦–å…ˆçœ‹ä¸€ä¸‹ï¼Œæˆ‘ä»¬çš„ new Vue, è¿™æ˜¯æ‰€æœ‰æ“ä½œçš„å…¥å£

```JavaScript
new Vue({
  data: {
    nickname: 'å¼ ä¸‰',
    email: "123123@qq.com"
  },
  el: '#app'
})
```
ç›¸ä¿¡ä½¿ç”¨è¿‡`Vue `çš„å°ä¼™ä¼´éƒ½æ˜ç™½ï¼Œ è¿™é‡Œå®šä¹‰äº†ä¸€ä¸ª`data`ï¼Œ ç”¨äºå­˜æ”¾å˜é‡ï¼Œ elæ˜¯ç›®æ ‡`dom`çš„é€‰æ‹©å™¨

### ğŸ”¥ new Vue æ‰§è¡Œæ—¶åšäº†ä»€ä¹ˆ

```JavaScript
function Vue(option) {
  var data = option.data 
  this.data = data
  // æŒ‚è½½ getter å’Œ setter
  observe(data, this)
  var id = option.el
  // ç¼–è¯‘ æ¨¡æ¿
  var dom = new Compile(document.querySelector(id), this)
  // æŠŠç¼–è¯‘å¥½çš„æ¨¡æ¿æŒ‚è½½åˆ° #app ä¸Š
  document.querySelector(id).appendChild(dom)
}
```

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ Vueå…¶å®æ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œ å®ƒæ¥æ”¶äº†ä¸€ä¸ªå‚æ•°`option`ï¼Œ è¿™ä¸ª`option`å°±æ˜¯æˆ‘ä»¬`new Vue`ä¼ å…¥çš„é‚£ä¸ªå¯¹è±¡
å› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡`option` æ‹¿åˆ°`data`å’Œ`el`ä¸¤ä¸ªå˜é‡ï¼Œ å½“ç„¶è¿™æ˜¯jsåŸºç¡€å“ˆï¼Œ æˆ‘å°±ä¸å†è¯´äº†

æ‹¿åˆ°`data`åï¼Œ æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®ƒè°ƒç”¨äº†ä¸€ä¸ª `observe`æ–¹æ³•, å°†dataå’Œthisä¼ å…¥( æ­¤æ—¶thisæ—¶Vueå®ä¾‹ )

æ¥ä¸‹æ¥åˆæ ¹æ®`el`æ¥è·å–`dom`ï¼Œ åŒæ ·çš„å°†è·å–åˆ°çš„`dom`å’Œ`this`ä¼ å…¥äº† `Compile`ä¸­ï¼Œ  å¹¶ä¸”è¿˜æ¥æ”¶äº†ä¸€ä¸ªè¿”å›å€¼ï¼Œ ç„¶ååˆå°†è¿™ä¸ªè¿”å›å€¼æŒ‚åˆ°äº† `#app`ä¸Š

æ˜¯ä¸æ˜¯æ„Ÿè§‰ï¼Œ ä»€ä¹ˆé¬¼ï¼Ÿ, è¿™é¡¿æ“ä½œæ˜¯å•¥

é¦–å…ˆçœ‹ä¸€ä¸‹ç–‘æƒ‘çš„ `observe`ï¼Œ ä¼ å…¥äº† `data`ï¼Œ `this`, ç„¶åå°±æ²¡åŠ¨é™äº†ï¼Œ æ—¢ç„¶å¦‚æ­¤ï¼Œ æˆ‘ä»¬å°±è¿›å…¥`observe`çœ‹çœ‹

æ‰¾åˆ°`Observe`çš„æ„é€ å‡½æ•°
```JavaScript
function observe(obj, vm) {
  Object.keys(obj).forEach(key => {
    defineReactive(vm, key, obj[key])
  })
}
```
å¯ä»¥çœ‹åˆ°ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ª`obj`å’Œ `vm`ï¼Œ å“¦ï¼Œ è¿™é‡Œå°±ä¸€ä¸€å¯¹åº”ä¸Šäº†ï¼Œ å°±æ˜¯æˆ‘ä»¬åˆšæ‰ä¼ å…¥çš„ `data`å’Œ`this` 

æ¥çœ‹çœ‹å®ƒåšäº†ä»€ä¹ˆï¼Œ 

å®ƒæŠŠ`obj`æšä¸¾äº†ä¸€éï¼Œ å¹¶å°†æ¯ä¸€æ¬¡çš„  `vm`, `key`,`value` éƒ½ä¼ å…¥ä¸€ä¸ªå« `defineReactive`çš„æ–¹æ³•


å¥½ï¼Œé‚£å°±è®©æ¥çœ‹`defineReactive`åšäº†ä»€ä¹ˆ

```JavaScript
function defineReactive(vm, key, val) {
  // ä¸ºæ¯ä¸ªå˜é‡åˆ†é…ä¸€ä¸ª depå®ä¾‹
  var dep = new Dep()
  // é…ç½®getterå’Œsetterå¹¶ä¸”æŒ‚è½½åˆ°vmä¸Š
  Object.defineProperty(vm, key, {
    get() {
      if ( Dep.target ) {
        // JSçš„æµè§ˆå™¨å•çº¿ç¨‹ç‰¹æ€§ï¼Œ ä¿è¯æ•´ä¸ªå…¨å±€å˜é‡åœ¨åŒä¸€æ—¶é—´å†…ï¼Œ åªæœ‰ä¸€ä¸ªç›‘å¬å™¨ä½¿ç”¨
        dep.addSub(Dep.target)
      }
      return val
    },
    set(newVal) {
      if ( newVal == val ) return;
      val = newVal;
      // ä½œä¸ºå‘å¸ƒè€…å‘å‡ºé€šçŸ¥
      dep.notify()
    }
  })
}
```

æˆ‘ä»¬çœ‹åˆ°ï¼Œ å®ƒ`new`äº†ä¸€ä¸ª`Dep`ï¼Œ è¿™ä¸ª`Dep`å°±æ˜¯æŠ¥åˆŠäº­å¤§çˆ·çš„ç”µè¯æœ¬ï¼Œ ç”¨æ¥æ”¶é›†æ‰€æœ‰æƒ³ä¹°æŠ¥çº¸æˆ–æ‚å¿—çš„äººçš„ç”µè¯ï¼Œ ç­‰åˆ°åˆ°è´§æ—¶å°±å¥½æŒ¨ä¸ªé€šçŸ¥

ç„¶åæˆ‘ä»¬çœ‹åˆ°äº†çµé­‚å‡½æ•° `Object.defineProperty`,  

å—·é‚£æˆ‘ä»¬åº”è¯¥å°±æ˜ç™½äº†ï¼Œ è¿™é‡Œçš„ä¸€é¡¿æ“ä½œå°±æ˜¯ä¸ºäº†ç»™`data`é‡Œçš„æ¯ä¸ªå±æ€§éƒ½æŒ‚è½½ä¸Š `getter`ï¼Œ`setter`, å¹¶ä¸”å°†è¿™äº›å±æ€§ç›´æ¥è½¬ç§»åˆ°äº†`vm`ä¸Šï¼ˆVueå®ä¾‹ï¼‰

é‚£æ—¢ç„¶å¦‚æ­¤ï¼Œ 

ğŸ¤ªè®©æˆ‘ä»¬çœ‹çœ‹ `getter`æ–¹æ³•åšäº†ä»€ä¹ˆï¼Œ 

é¦–å…ˆå®ƒåˆ¤æ–­äº†ä¸€ä¸‹`Dep.target`ï¼Œ  å¦‚æœ`Dep.target`ä¸º`true` , å°±è°ƒç”¨`dep`çš„`addSub`æ–¹æ³•ï¼Œ è¿™é‡Œ`Dep.target`æ˜¯å•¥æˆ‘ä»¬å…ˆä¸ç®¡ï¼Œ ç•™ä¸ªå°è±¡å³å¯

ç„¶åå®ƒç›´æ¥`return`äº†`val`

ğŸ˜µå†æ¥çœ‹çœ‹`setter`æ–¹æ³•




















## Vue3é‡å†™çš„åŸå› 
// `Obejct.defineProperty`


é¡¹ç›®æºç :
> https://github.com/nxl3477/note/tree/master/Javascript/Vue/%E5%AE%9E%E7%8E%B0vue

ä¼˜è´¨æ–‡çŒ®: 
* [æ±¤å§†å¤§å”çš„è§‚å¯Ÿè€…æ¨¡å¼](http://www.cnblogs.com/TomXu/archive/2012/03/02/2355128.html)