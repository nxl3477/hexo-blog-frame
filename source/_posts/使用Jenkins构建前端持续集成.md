---
title: ä½¿ç”¨Jenkinsæ„å»ºå‰ç«¯æŒç»­é›†æˆ
date: 2019-03-16 12:34:36
categories: CI
tags: [CI, Jenkins, Centos, å‰ç«¯æŒç»­é›†æˆ]
---
<script type="text/javascript" src="/js/src/bai.js"></script>


1. å®‰è£…JDK

ç›´æ¥ä½¿ç”¨yum å®‰è£…çš„æ˜¯ `openjdk` , å’Œsun å…¬å¸å‘å¸ƒçš„jdkæœ‰ç•¥å¾®åŒºåˆ«ï¼Œ ä½†è¿™é‡Œæˆ‘ä»¬å¹¶ä¸éœ€è¦ä½¿ç”¨java,æ‰€ä»¥ä½¿ç”¨æœ€å¿«çš„æ–¹å¼å®‰è£…


```
yum install -y java
```

2. å®‰è£…jenkins

æ·»åŠ Jenkinsåº“åˆ°yumåº“ï¼ŒJenkinså°†ä»è¿™é‡Œä¸‹è½½å®‰è£…ã€‚

```
wget -O /etc/yum.repos.d/jenkins.repo http://pkg.jenkins-ci.org/redhat/jenkins.repo
rpm --import https://jenkins-ci.org/redhat/jenkins-ci.org.key
yum install -y jenkins
```

æ·»åŠ Jenkinsåº“åˆ°yumåº“ï¼ŒJenkinså°†ä»è¿™é‡Œä¸‹è½½å®‰è£…ã€‚
```
wget http://pkg.jenkins-ci.org/redhat-stable/jenkins-2.7.3-1.1.noarch.rpm
rpm -ivh jenkins-2.7.3-1.1.noarch.rpm
```

3. é…ç½®jenkisçš„ç«¯å£

jenkins çš„é»˜è®¤ç«¯å£ä¸º 8080 ï¼Œ ä¸ºäº†é¿å…å’Œå…¶ä»–çš„åº”ç”¨ç¨‹åºå†²çªï¼Œ æ‰€ä»¥å»ºè®®ä¿®æ”¹ä¸€ä¸‹é»˜è®¤å ç”¨çš„ç«¯å£

```
vim /etc/sysconfig/jenkins
```

æ‰¾åˆ°ä¿®æ”¹ç«¯å£å·ï¼š

> JENKINS_PORT="8080" 

4. å¯åŠ¨jenkins 


```
service jenkins start/stop/restart
```
* å®‰è£…æˆåŠŸåJenkinså°†ä½œä¸ºä¸€ä¸ªå®ˆæŠ¤è¿›ç¨‹éšç³»ç»Ÿå¯åŠ¨
* ç³»ç»Ÿä¼šåˆ›å»ºä¸€ä¸ªâ€œjenkinsâ€ç”¨æˆ·æ¥å…è®¸è¿™ä¸ªæœåŠ¡ï¼Œå¦‚æœæ”¹å˜æœåŠ¡æ‰€æœ‰è€…ï¼ŒåŒæ—¶éœ€è¦ä¿®æ”¹`/var/log/jenkins`, `/var/lib/jenkins`, å’Œ`/var/cache/jenkins`çš„æ‰€æœ‰è€…
* å¯åŠ¨çš„æ—¶å€™å°†ä»/etc/sysconfig/jenkinsè·å–é…ç½®å‚æ•°
* é»˜è®¤æƒ…å†µä¸‹ï¼ŒJenkinsè¿è¡Œåœ¨8080ç«¯å£ï¼Œåœ¨æµè§ˆå™¨ä¸­ç›´æ¥è®¿é—®è¯¥ç«¯è¿›è¡ŒæœåŠ¡é…ç½®
* Jenkinsçš„RPMä»“åº“é…ç½®è¢«åŠ åˆ°/etc/yum.repos.d/jenkins.repo


## é…ç½®é˜¶æ®µ
å®‰è£…å¥½`jenkins` å ï¼Œ æˆ‘ä»¬å°±å¯ä»¥æ ¹æ®åˆšæ‰æ‰€è®¾ç½®çš„ç«¯å£å·è®¿é—® `jenkins` æœåŠ¡äº† 

æ¯”å¦‚è¿›å…¥ `127.0.0.1:8081` è®¿é—®`jenkins`

é¦–å…ˆä¼šçœ‹åˆ°è®©æˆ‘ä»¬è¾“å…¥åˆå§‹å¯†ç 

å®ƒæç¤ºæˆ‘ä»¬è¿›å…¥ `/var/lib/jenkins/secrets/initialAdminPassword ` æŸ¥çœ‹

![è¾“å…¥åˆå§‹å¯†ç ](http://img.nixiaolei.com/2019-03-09-16-16-27.png)



è¾“å…¥å¯†ç æ— è¯¯åï¼Œ å°±æ˜¯æç¤ºæˆ‘ä»¬å®‰è£…å¯¹åº”çš„æ’ä»¶äº†ï¼Œ

å·¦è¾¹æ˜¯æ¨èå®‰è£…ï¼Œ å³è¾¹æ˜¯è‡ªå®šä¹‰å®‰è£…ï¼Œ  è¿™é‡Œæˆ‘ä»¬å»ºè®®ç‚¹å‡» `æ¨èå®‰è£…`

![é€‰æ‹©æ¨èå®‰è£…](http://img.nixiaolei.com/2019-03-09-16-17-31.png)




å®‰è£…è¿‡ç¨‹å¯èƒ½ç¨é•¿

![ç­‰å¾…å®‰è£…å®Œæ¯• ](http://img.nixiaolei.com/jenkins03.png)


è¿™æ—¶æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª `Jenkins` è´¦æˆ·ï¼Œ 
ä¸€å®šè¦ç‰¢è®°ä½ çš„è¾“å…¥è´¦å·å’Œå¯†ç ï¼Œ ç”¨ä½œä¹‹åçš„ç™»å½•

![åˆ›å»ºè´¦æˆ·](http://img.nixiaolei.com/2019-03-09-16-29-08.png)



åˆ›å»ºè´¦æˆ·ä¹‹åï¼Œ ä¼šæ˜¾ç¤ºä¸€ä¸ª `jenkins` çš„èµ„æºæ ¹è·¯å¾„ï¼Œ ä¸€èˆ¬ä¸éœ€è¦ä¿®æ”¹ï¼Œ ä¿æŒé»˜è®¤å³å¯


![èµ„æºè·¯å¾„](http://img.nixiaolei.com/2019-03-09-16-32-04.png)




ä¹‹åå°±æ˜¯æ„‰å¿«çš„`jenkins` ä¹‹æ—…å•¦

![å¼€å§‹ä½¿ç”¨Jenkins](http://img.nixiaolei.com/2019-03-09-16-32-37.png)


## è¡¥å–„æ’ä»¶é˜¶æ®µ
æˆ‘ä»¬è¦åšçš„å‰ç«¯æŒç»­é›†æˆï¼Œ æ‰€ä»¥ `jenkins` é»˜è®¤å®‰è£…çš„æ’ä»¶ å¹¶ä¸èƒ½å®Œå…¨çš„æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚

è¿›å…¥`jenkins` ä¸»é¡µé¢åï¼Œ æ‰¾åˆ°æ’ä»¶ç®¡ç†

![æ’ä»¶ç®¡ç†](http://img.nixiaolei.com/2019-03-09-16-36-26.png)



é¦–å…ˆæŸ¥çœ‹æˆ‘ä»¬å¿…è¦çš„æ’ä»¶æ˜¯å¦å®‰è£…å¥½äº†
* NodeJs Plugin
* Publish Over SSH
* GitHub

å¦‚æœå‘ç°æ²¡æœ‰å®‰è£…çš„å°±å®‰è£…ï¼Œ æŸ¥æ¼è¡¥ç¼º



## å˜é‡åŠè¿œç¨‹æœåŠ¡å™¨åŸºæœ¬é…ç½®

æ’ä»¶å®‰è£…å¥½å, è¿›å…¥`ç³»ç»Ÿè®¾ç½®` ç•Œé¢, è¿›è¡Œå˜é‡çš„ç›¸å…³é…ç½®, è¿™é‡Œå°±å±•ç¤ºå‡ ä¸ªå¯ä»¥ä¿®æ”¹çš„å‚æ•°, å¤§éƒ¨åˆ†éƒ½å¯ä»¥ä¸ç”¨åŠ¨, ä½¿ç”¨é»˜è®¤å°±å¥½

![ç³»ç»Ÿè®¾ç½®](http://img.nixiaolei.com/2019-03-09-17-36-54.png)


ç®¡ç†å‘˜é‚®ä»¶åœ°å€, æ¨èå¡«å†™,  å½“jenkins å·¥ä½œå®Œæˆåä¼šæŠŠ æ„å»ºä¿¡æ¯å‘é€è‡³æ­¤é‚®ç®±

![é‚®ä»¶åœ°å€](http://img.nixiaolei.com/2019-03-09-17-42-24.png)

(è¿™æ¡é€‰æ‹©å¡«å†™) å¯ä»¥é€‰æ‹©é…ç½® github æœåŠ¡å™¨, å¹¶ä¸”å¯ä»¥é…ç½®å¤šä¸ª, å› ä¸ºä½ çš„é¡¹ç›®ä»£ç æœ‰å¯èƒ½åœ¨å¤šä¸ªæœåŠ¡å™¨ä¸Š

![github](http://img.nixiaolei.com/2019-03-09-17-43-51.png)


æ¯”è¾ƒé‡è¦çš„å°±æ˜¯è¿™é‡Œäº† ,  é…ç½®è¿œç¨‹æœåŠ¡å™¨, ä¹Ÿå°±æ˜¯ä½ çš„å‘å¸ƒåœ°å€

ç‚¹å‡»æ–°å¢æ·»åŠ ä½ çš„æœåŠ¡å™¨

![æ·»åŠ ä½ çš„æœåŠ¡å™¨](http://img.nixiaolei.com/2019-03-09-17-48-05.png)



ç‚¹å‡»æ–°å¢å, è¿™é‡Œæœ‰å‡ ä¸ªå…³é”®çš„å‚æ•°,  éœ€è¦æ³¨æ„

![å‚æ•°æ³¨æ„](http://img.nixiaolei.com/2019-03-09-17-51-39.png)

è¿æ¥ç›®æ ‡æœåŠ¡å™¨è‚¯å®šéœ€è¦ç™»å½•,  ä¸‹é¢å‡ ä¸ªå‚æ•°å°±æ˜¯å¯¹åº”çš„éªŒè¯å‚æ•°, ä½ å¯ä»¥è¾“å…¥å›ºå®šçš„å¯†ç , ä¹Ÿå¯ä»¥å‘Šè¯‰Jenkins ä½ çš„æœ¬åœ°ç§é’¥è·¯å¾„æˆ–ç§é’¥çš„å†…å®¹,  å‰ææ˜¯ä½ é…ç½®äº† ssh çš„å…å¯†ç™»å½•

![é…ç½®å…å¯†](http://img.nixiaolei.com/2019-03-09-17-54-49.png)


> å¡«å†™å¯†é’¥è·¯å¾„è¿™é‡Œä½ å¾ˆæœ‰å¯èƒ½ä¼šå‡ºç°æƒé™ä¸å¤Ÿçš„é”™è¯¯ï¼Œ å¦‚ä¸‹å›¾ï¼Œ


![ç¼–è·¯å¾„é”™è¯¯](http://img.nixiaolei.com/2019-03-10-10-43-33.png)




å› ä¸º`jenkins `çš„åœ¨è¿è¡Œæ—¶ä¼šè‡ªåŠ¨çš„åˆ›å»ºä¸€ä¸ªåä¸º`jenkins`çš„ç”¨æˆ·ï¼Œ è€Œè¿™ä¸ªç”¨æˆ·çš„æƒé™ä¸å¤Ÿï¼Œæ— æ³•è®¿é—®ä½ çš„ç›®å½•

![ç¼–è¿è¡Œèº«ä»½](http://img.nixiaolei.com/2019-03-10-10-46-12.png)



è§£å†³æ–¹æ¡ˆæœ‰ä¸¤ä¸ª:
1. æŠŠå¯†é’¥åˆ‡æ¢è‡³ä¸€ä¸ªæ™®é€šç”¨æˆ·å¯ä»¥è®¿é—®çš„ç›®å½•ï¼Œ å¹¶ä¿®æ”¹å¯†é’¥çš„æ‰€å±ç”¨æˆ·èº«ä»½å’Œè®¿é—®æƒé™
2. æŠŠ`jenkins` çš„è¿è¡Œèº«ä»½ä¿®æ”¹ä¸º `root`, ä½†æ˜¯ä¼šæœ‰ç‚¹å®‰å…¨æ€§é—®é¢˜

æœ¬æ¬¡å®è·µä»¥å­¦ä¹ ä¸ºç›®çš„ï¼Œ æ‰€ä»¥è¿™é‡Œæˆ‘é€‰æ‹©äº†ç¬¬äºŒé’Ÿ

> ç›¸å…³æ“ä½œæ–‡ç« : https://blog.csdn.net/jeikerxiao/article/details/80768949


ssh å…å¯†é…ç½®æˆåŠŸåï¼Œ æˆ‘ä»¬å°±å¯ä»¥å¼€å§‹åˆ›å»ºä¸€ä¸ªè‡ªå·±çš„ä»»åŠ¡äº†



## åˆ›å»ºä»»åŠ¡é˜¶æ®µ

å›åˆ°ä¸»é¡µï¼Œ æ‰¾åˆ°`æ–°å»ºä»»åŠ¡`


![ç¼–æ–°å»ºä»»åŠ¡](http://img.nixiaolei.com/2019-03-10-10-55-02.png)



è¿›å…¥æ–°å»ºä»»åŠ¡åï¼Œ æœ‰å‡ ç§ä¸åŒçš„é¡¹ç›®ï¼Œ æˆ‘ä»¬è¿™é‡Œé€‰æ‹© `è‡ªç”±é£æ ¼`ï¼Œ å¹¶ä¸”è¾“å…¥é¡¹ç›®åç§°

![ç¼–è‡ªç”±é£æ ¼](http://img.nixiaolei.com/2019-03-10-10-59-00.png)

åˆ›å»ºå¥½é¡¹ç›®åå°±ä¼šè‡ªåŠ¨è¿›å…¥ å½“å‰é¡¹ç›®çš„é…ç½®æ–‡ä»¶ä¸­


é¦–å…ˆæˆ‘ä»¬çœ‹åˆ°`General`, è¿™æ˜¯ä¸€äº›å…¨å±€çš„é…ç½®ï¼Œ åœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥å†™ä¸Šè¯¥é¡¹ç›®çš„æè¿°

![ç¼–å…¨å±€é…ç½®](http://img.nixiaolei.com/2019-03-10-11-02-26.png)


`General`çš„åé¢å‡ ä¸ªç±»ç›®æ˜¯æ„å»ºé¡¹ç›®é˜¶æ®µå‡ ä¸ªæ¯”è¾ƒå¤§çš„æ­¥éª¤å’Œæµç¨‹


å¦‚æœä½ è¦é…ç½®çš„â€œgithubâ€é¡¹ç›®ï¼Œ å¯ä»¥åœ¨`Git`è¿™é‡Œæ‰“ä¸Šå‹¾

å¹¶ä¸”å¡«å†™ä¸Šä»“åº“åœ°å€ åŠ åˆ†æ”¯ å³å¯ï¼Œ å¦‚æœéœ€è¦å¡«å†™è´¦æˆ·å¯†ç ï¼Œ åˆ™å¯åœ¨`	Credentials` å¤„æ–°å¢é…ç½®


![ç¼–githubé¡¹ç›®](http://img.nixiaolei.com/2019-03-10-11-11-35.png)


æ¥ä¸‹æ¥æ˜¯çœ‹çœ‹æ„å»ºè§¦å‘å™¨ï¼Œ è¿™é‡Œçš„å¡«å†™æ ¹æ®ä½ çš„å·¥ç¨‹éœ€è¦ï¼Œ 

å¯ä»¥é…ç½®å®šæ—¶ä»»åŠ¡ æˆ– å¤šä»»åŠ¡æ„å»º

> æœ¬æ¬¡æ¼”ç¤ºæˆ‘å¹¶æ²¡æœ‰ç”¨åˆ°

![ç¼–è§¦å‘å™¨](http://img.nixiaolei.com/2019-03-10-13-26-16.png)



ç°åœ¨æ¥åˆ°æˆ‘ä»¬çš„é‡ç‚¹`æ„å»º` ï¼Œ 

æˆ‘ä»¬å¯ä»¥æ·»åŠ æ­¥éª¤ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°èƒ½å¤Ÿæ”¯æŒ `Node`ã€`shell` ã€`æ‰¹å¤„ç†`ç­‰ç­‰æ–¹å¼

è¿™äº›æ·»åŠ çš„æ­¥éª¤ä¼šæŒ‰é¡ºåºæ‰§è¡Œï¼Œ 

![ç¼–æ„å»º](http://img.nixiaolei.com/2019-03-10-13-30-56.png)


æˆ‘ä»¬éœ€è¦`shell` è„šæœ¬æ¥è¿è¡Œnpm å‘½ä»¤

æ‰€ä»¥æˆ‘åˆ›å»ºäº† `shell`çš„æ“ä½œæ­¥éª¤

![ç¼–shellè„šæœ¬](http://img.nixiaolei.com/2019-03-10-13-35-35.png)



åŸºäºæ­¤ï¼Œ `jenkins` å°±ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬åšå¥½ æµ‹è¯•ä¸æ‰“åŒ…çš„æ­¥éª¤ï¼Œ

åœ¨æ­¤ä¹‹åï¼Œ æˆ‘ä»¬éœ€è¦å°†æµ‹è¯•é€šè¿‡çš„é¡¹ç›®ä»£ç æ¨é€åˆ°è¿œç¨‹å‘å¸ƒæœåŠ¡å™¨ä¸Šï¼Œ æ‰€ä»¥ï¼Œ æˆ‘ä»¬æ·»åŠ ä¸€ä¸ª`send files or execute commands over SSH` æ­¥éª¤ï¼Œ 


![ç¼–overSSH](http://img.nixiaolei.com/2019-03-16-13-05-58.png)


å»ºè®®æ–°æ—§æ–‡ä»¶æä¸¤ä¸ªæ–‡ä»¶å¤¹å­˜æ”¾ï¼Œ è¿™æ ·å¯ä»¥å…ˆåˆ é™¤æ‰æ—§æ–‡ä»¶å†æŠŠæ–°æ–‡ä»¶æ‹·è´è¿‡å»

> deployæ–‡ä»¶å‚è€ƒ

![ç¼–deployæ–‡ä»¶å‚è€ƒ](http://img.nixiaolei.com/2019-03-16-13-08-32.png)



## ä½ å¯èƒ½é‡åˆ°çš„é—®é¢˜

### å‘½ä»¤æ— æ•ˆæˆ–ä¸å­˜åœ¨
> è¿™é‡Œæ‹¿npmä¸¾ä¾‹ï¼Œ  å…¶ä»–å‘½ä»¤å¦‚:node ,éƒ½æ˜¯åŒç†

![ç¼–æ— æ³•ä½¿ç”¨npmå‘½ä»¤](http://img.nixiaolei.com/2019-03-16-12-54-06.png)


å› ä¸ºå…¨å±€çš„å‘½ä»¤éœ€è¦è®¾ç½®`è½¯è¿æ¥` Jenkins æ‰å¯ä»¥è®¿é—®çš„åˆ°

å¦‚ä½•è®¾ç½®:

å…ˆæŸ¥çœ‹ä¸€ä¸‹ä½ çš„ npm åœ¨å“ª
> whereis npm

![ç¼–æŸ¥çœ‹npmä½ç½®](http://img.nixiaolei.com/2019-03-16-12-57-08.png)

è¿™ä¸ª`/usr/local/bin/npm` å°±æ˜¯ä½ çš„npmæ‰€åœ¨ä½ç½® ( ä½¿ç”¨å¸¦ `local` çš„åœ°å€)

æˆ‘ä»¬æ¥åˆ›å»º `è½¯è¿æ¥`, è¿™é‡Œä½¿ç”¨åˆšåˆšè·å–åˆ°çš„npm 

> ln -s /usr/local/bin/npm   /usr/bin
 

å¦‚æœå‡ºç°æ— æ³•ä¿®æ”¹çš„æƒ…å†µï¼Œ é‚£æˆ‘ä»¬å°±å°†ä»–å¼ºåˆ¶æ›´æ”¹ ğŸ˜„

> ln -sf /usr/local/bin/npm   /usr/bin


å†å»æ„å»ºä¸€æ¬¡Jenkins ä»»åŠ¡

çœ‹åˆ°æ§åˆ¶å°è¾“å‡ºï¼Œ ç°åœ¨npm å¯ä»¥æ­£å¸¸è¿è¡Œäº†

![ç¼–npmè¿è¡ŒæˆåŠŸ](http://img.nixiaolei.com/2019-03-10-18-56-51.png)






## æŒç»­é›†æˆçš„å¿…è¦æ¡ä»¶
1. å¿…é¡»æœ‰github ã€svnæˆ–ç§æœ‰gitæœåŠ¡å™¨
2. å®Œæ•´çš„é¡¹ç›®
  1. test
  2. æ¥å£æµ‹è¯•
  3. å…¶ä»–çš„æµ‹è¯•å†…å®¹
3. CI å¹³å°
4. é¡¹ç›®ä»£ç è¦æäº¤åˆ°Githubã€ svnç­‰æœåŠ¡å™¨ä¸Š
5. ä¿è¯ä»£ç åœ¨å¼€å‘æœºçš„æ­£å¸¸
  1. bug
  2. è¿è¡Œç¯å¢ƒ ( å¼•ç”¨çš„åŒ…è¦å†™å…¥packa)
6. ä¿è¯jenkins ç¯å¢ƒä¸€åˆ‡æ­£å¸¸
7. å‘å¸ƒæœåŠ¡å™¨ä¸Šä¹Ÿè¦å­˜åœ¨åŸºç¡€çš„è¿è¡Œç¯å¢ƒ(ä¸åŒ…æ‹¬é¡¹ç›®æœ¬èº«å¼•ç”¨çš„åŒ…)
8. å¿…è¦çš„é™æ€èµ„æºæœåŠ¡å™¨
9. é…ç½®jenkinsçš„è‡ªåŠ¨åŒ–å¤„ç†æµç¨‹




å‚è€ƒæ–‡ç« :
> https://www.cnblogs.com/loveyouyou616/p/8714544.html

